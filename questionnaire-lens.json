{
  "resourceType": "Library",
  "id": "questionnaire-lens",
  "meta": {
    "profile": [
      "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lens"
    ]
  },
  "extension": [
    {
      "url": "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lee-version",
      "valueString": "dev"
    }
  ],
  "url": "https://gravitate-health.lst.tfo.upm.es/ips/api/fhir/Library/592",
  "identifier": [
    {
      "system": "http://gravitate-health.lst.tfo.upm.es",
      "value": "questionnaire-lens"
    }
  ],
  "version": "0.0.1",
  "name": "High Risk Medication Lens",
  "_name": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente de Cuestionario"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente de Interação"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Interaktionslinse"
          }
        ]
      }
    ]
  },
  "date": "2024-06-12T13:40:03.690Z",
  "title": "Questionnaire Lens",
  "_title": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente de Cuestionario"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente de Interação"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Interaktionslinse"
          }
        ]
      }
    ]
  },
  "status": "draft",
  "experimental": true,
  "type": {
    "coding": [
      {
        "code": "logical-library"
      }
    ]
  },
  "publisher": "Gravitate Health Project - UPM Team",
  "contact": [
    {
      "name": "Gravitate Health",
      "telecom": [
        {
          "system": "url",
          "value": "https://www.gravitatehealth.eu/"
        }
      ]
    }
  ],
  "description": "A lens that highlight any information related to interactions between other mediciones or ePIs",
  "_description": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Una lente que resalta cualquier información relacionada con interacciones entre otros medicamentos o ePIs."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Uma lente que destaca qualquer informação relacionada com interações entre outros medicamentos ou ePIs."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "En linse, der fremhæver al information relateret til interaktioner mellem andre lægemidler eller ePI'er."
          }
        ]
      }
    ]
  },
  "jurisdiction": [
    {
      "coding": [
        {
          "code": "EU",
          "system": "urn:iso:std:iso:3166"
        }
      ]
    }
  ],
  "purpose": "Clarify the important things related to interactions between other ePIs in the ePI provided",
  "_purpose": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Aclarar los aspectos importantes relacionados con interacciones entre otros ePIs en el ePI proporcionado."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Esclarecer os pontos importantes relacionados com interações entre outros ePIs no ePI fornecido."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Klargør de vigtige ting vedrørende interaktioner mellem andre ePI'er i den angivne ePI."
          }
        ]
      }
    ]
  },
  "usage": "This lens requires a preprocessed ePI, and an IPS to work. You can import this lens directly to your FHIR Server which suports Library Resource type.",
  "_usage": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Esta lente requiere una ePI preprocesada y un IPS para funcionar. Puedes importar esta lente directamente en tu servidor FHIR que soporte el tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Esta lente requer uma ePI pré-processada e um IPS para funcionar. Podes importar esta lente diretamente para o teu servidor FHIR que suporte o tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Denne linse kræver en forbehandlet ePI og en IPS for at fungere. Du kan importere denne linse direkte til din FHIR-server, som understøtter ressource-typen Library."
          }
        ]
      }
    ]
  },
  "copyright": "© 2024 Gravitate Health",
  "parameter": [
    {
      "use": "in",
      "documentation": "parameter if it exists",
      "type": "CodeableConcept"
    }
  ],
  "content": [
    {
      "contentType": "application/javascript",
      "data": "bGV0IHB2RGF0YSA9IHB2Ow0KbGV0IGh0bWxEYXRhID0gaHRtbDsNCg0KbGV0IGVwaURhdGEgPSBlcGk7DQpsZXQgaXBzRGF0YSA9IGlwczsNCmxldCBsYW5nID0gIiI7ICAvLyBEZWZhdWx0IGxhbmd1YWdlLCB3aWxsIGJlIHNldCBieSBlUEkNCg0KLy8gLS0tIExhbmd1YWdlIGRpY3Rpb25hcnkgZm9yIHVzZXItZmFjaW5nIG1lc3NhZ2VzIC0tLQ0KY29uc3QgbGFuZ3VhZ2VEaWN0ID0gew0KICAgIGVuOiB7DQogICAgICAgIGJhbm5lcldhcm5pbmc6ICKgDyBUaGlzIG1lZGljYXRpb24gbWF5IGNhdXNlIGhpZ2gtcmlzayBzaWRlIGVmZmVjdHMuIiwNCiAgICAgICAgcXVlc3Rpb25uYWlyZUxpbms6ICJGaWxsIG91dCBzYWZldHkgcXVlc3Rpb25uYWlyZSIsDQogICAgICAgIGZpbGxRdWVzdGlvbm5haXJlOiAiPd0gRmlsbCBvdXQgc2FmZXR5IHF1ZXN0aW9ubmFpcmUiDQogICAgfSwNCiAgICBlczogew0KICAgICAgICBiYW5uZXJXYXJuaW5nOiAioA8gRXN0ZSBtZWRpY2FtZW50byBwdWVkZSBjYXVzYXIgZWZlY3RvcyBzZWN1bmRhcmlvcyBkZSBhbHRvIHJpZXNnby4iLA0KICAgICAgICBxdWVzdGlvbm5haXJlTGluazogIlJlbGxlbmFyIGN1ZXN0aW9uYXJpbyBkZSBzZWd1cmlkYWQiLA0KICAgICAgICBmaWxsUXVlc3Rpb25uYWlyZTogIj3dIFJlbGxlbmFyIGN1ZXN0aW9uYXJpbyBkZSBzZWd1cmlkYWQiDQogICAgfSwNCiAgICBwdDogew0KICAgICAgICBiYW5uZXJXYXJuaW5nOiAioA8gRXN0ZSBtZWRpY2FtZW50byBwb2RlIGNhdXNhciBlZmVpdG9zIHNlY3VuZOFyaW9zIGRlIGFsdG8gcmlzY28uIiwNCiAgICAgICAgcXVlc3Rpb25uYWlyZUxpbms6ICJQcmVlbmNoZXIgcXVlc3Rpb27hcmlvIGRlIHNlZ3VyYW7nYSIsDQogICAgICAgIGZpbGxRdWVzdGlvbm5haXJlOiAiPd0gUHJlZW5jaGVyIHF1ZXN0aW9u4XJpbyBkZSBzZWd1cmFu52EiDQogICAgfSwNCiAgICBkYTogew0KICAgICAgICBiYW5uZXJXYXJuaW5nOiAioA8gRGVubmUgbWVkaWNpbiBrYW4gZm9y5XJzYWdlIGFsdm9ybGlnZSBiaXZpcmtuaW5nZXIuIiwNCiAgICAgICAgcXVlc3Rpb25uYWlyZUxpbms6ICJVZGZ5bGQgc2lra2VyaGVkc3Nw+HJnZXNrZW1hIiwNCiAgICAgICAgZmlsbFF1ZXN0aW9ubmFpcmU6ICI93SBVZGZ5bGQgc2lra2VyaGVkc3Nw+HJnZXNrZW1hIg0KICAgIH0NCn07DQoNCi8vIFN0YXRlIHRvIHRyYWNrIGlmIHF1ZXN0aW9ubmFpcmUgbGluayB3YXMgYWRkZWQNCmxldCBsaW5rQWRkZWQgPSBmYWxzZTsNCg0KbGV0IGdldFNwZWNpZmljYXRpb24gPSAoKSA9PiB7DQogICAgcmV0dXJuICIyLjAuMy1xdWVzdGlvbm5haXJlLWJhbm5lciI7DQp9Ow0KDQovLyAtLS0gVXRpbGl0eTogR2V0IGxhbmd1YWdlIGtleSBmcm9tIGRldGVjdGVkIGxhbmd1YWdlIC0tLQ0KY29uc3QgZ2V0TGFuZ0tleSA9IChsYW5ndWFnZSkgPT4gew0KICAgIGlmIChsYW5ndWFnZT8uc3RhcnRzV2l0aCgicHQiKSkgcmV0dXJuICJwdCI7DQogICAgaWYgKGxhbmd1YWdlPy5zdGFydHNXaXRoKCJlcyIpKSByZXR1cm4gImVzIjsNCiAgICBpZiAobGFuZ3VhZ2U/LnN0YXJ0c1dpdGgoImRhIikpIHJldHVybiAiZGEiOw0KICAgIHJldHVybiAiZW4iOyAvLyBEZWZhdWx0IHRvIEVuZ2xpc2gNCn07DQoNCi8vZG9jdW1lbnQsIGh0bWxEYXRhLCBiYW5uZXJIVE1MDQovLw0KY29uc3QgaW5zZXJ0UXVlc3Rpb25uYWlyZUxpbmsgPSAobGlzdE9mQ2F0ZWdvcmllcywgbGFuZ3VhZ2UsIGRvY3VtZW50LCByZXNwb25zZSkgPT4gew0KICAgIGNvbnN0IGxhbmdLZXkgPSBnZXRMYW5nS2V5KGxhbmd1YWdlKTsNCiAgICBjb25zdCBtZXNzYWdlcyA9IGxhbmd1YWdlRGljdFtsYW5nS2V5XTsNCiAgICBjb25zdCBsaW5rSFRNTCA9ICJodHRwczovL2V4YW1wbGUub3JnL3F1ZXN0aW9ubmFpcmUvaGlnaC1yaXNrIjsNCiAgICBsZXQgc2hvdWxkQXBwZW5kID0gZmFsc2U7IC8vZm9yIGZ1dHVyZSB1c2FnZQ0KICAgIGxldCBmb3VuZENhdGVnb3J5ID0gZmFsc2U7DQogICAgY29uc29sZS5sb2cobGlzdE9mQ2F0ZWdvcmllcykNCiAgICBjb25zb2xlLmxvZyhsaXN0T2ZDYXRlZ29yaWVzLmxlbmd0aCkNCiAgICBsaXN0T2ZDYXRlZ29yaWVzLmZvckVhY2goKGNsYXNzTmFtZSkgPT4gew0KICAgICAgICBpZiAoDQogICAgICAgICAgICByZXNwb25zZS5pbmNsdWRlcyhgY2xhc3M9IiR7Y2xhc3NOYW1lfWApIHx8DQogICAgICAgICAgICByZXNwb25zZS5pbmNsdWRlcyhgY2xhc3M9JyR7Y2xhc3NOYW1lfWApDQogICAgICAgICkgew0KICAgICAgICAgICAgY29uc3QgZWxlbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSk7DQogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgY29uc3QgZWwgPSBlbGVtZW50c1tpXTsNCiAgICAgICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOw0KICAgICAgICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJocmVmIiwgbGlua0hUTUwpOw0KICAgICAgICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJ0YXJnZXQiLCAiX2JsYW5rIik7DQogICAgICAgICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgInF1ZXN0aW9ubmFpcmUtbGVucyIpOw0KDQogICAgICAgICAgICAgICAgaWYgKHNob3VsZEFwcGVuZCkgew0KICAgICAgICAgICAgICAgICAgICAvLyBBcHBlbmQgdGhlIGxpbmsgYXMgYSBuZXcgZWxlbWVudCBpbnNpZGUgdGhlIGV4aXN0aW5nIGVsZW1lbnQNCiAgICAgICAgICAgICAgICAgICAgbGluay5pbm5lckhUTUwgPSBtZXNzYWdlcy5maWxsUXVlc3Rpb25uYWlyZTsNCiAgICAgICAgICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQobGluayk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gV3JhcCB0aGUgZXhpc3RpbmcgY29udGVudHMgb2YgdGhlIGVsZW1lbnQgaW4gdGhlIGxpbmsNCiAgICAgICAgICAgICAgICAgICAgbGluay5pbm5lckhUTUwgPSBlbC5pbm5lckhUTUw7DQogICAgICAgICAgICAgICAgICAgIGVsLmlubmVySFRNTCA9ICIiOw0KICAgICAgICAgICAgICAgICAgICBlbC5hcHBlbmRDaGlsZChsaW5rKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3VuZENhdGVnb3J5ID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICAgLy8gTm8gbWF0Y2hpbmcgY2F0ZWdvcnkgdGFncyCSIGluamVjdCBiYW5uZXIgYXQgdG9wDQogICAgaWYgKCFmb3VuZENhdGVnb3J5KSB7DQogICAgICAgIGNvbnN0IGJhbm5lckRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICBiYW5uZXJEaXYuaW5uZXJIVE1MID0gYA0KICAgICAgICAgICAgPGRpdiBjbGFzcz0iYWxlcnQtYmFubmVyIHF1ZXN0aW9ubmFpcmUtbGVucyIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6I2ZmZGRkZDtwYWRkaW5nOjFlbTtib3JkZXI6MXB4IHNvbGlkICNmZjg4ODg7bWFyZ2luLWJvdHRvbToxZW07Ij4NCiAgICAgICAgICAgICAgICAke21lc3NhZ2VzLmJhbm5lcldhcm5pbmd9DQogICAgICAgICAgICAgICAgPGEgaHJlZj0iJHtsaW5rSFRNTH0iIHRhcmdldD0iX2JsYW5rIiBzdHlsZT0ibWFyZ2luLWxlZnQ6IDFlbTsiPiR7bWVzc2FnZXMucXVlc3Rpb25uYWlyZUxpbmt9PC9hPg0KICAgICAgICAgICAgPC9kaXY+DQogICAgICAgIGA7DQoNCiAgICAgICAgY29uc3QgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImJvZHkiKTsNCiAgICAgICAgaWYgKGJvZHkpIHsNCiAgICAgICAgICAgIGJvZHkuaW5zZXJ0QmVmb3JlKGJhbm5lckRpdiwgYm9keS5maXJzdENoaWxkKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vIENsZWFuIGhlYWQgKHNhbWUgYXMgeW91ciBvcmlnaW5hbCBsb2dpYykNCiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKS5sZW5ndGggPiAwKSB7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF0ucmVtb3ZlKCk7DQogICAgfQ0KDQogICAgLy8gRXh0cmFjdCBIVE1MIHJlc3VsdA0KICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpLmxlbmd0aCA+IDApIHsNCiAgICAgICAgcmVzcG9uc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdLmlubmVySFRNTDsNCiAgICAgICAgY29uc29sZS5sb2coIlJlc3BvbnNlOiAiICsgcmVzcG9uc2UpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGNvbnNvbGUubG9nKCJSZXNwb25zZTogIiArIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5pbm5lckhUTUwpOw0KICAgICAgICByZXNwb25zZSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5pbm5lckhUTUw7DQogICAgfQ0KDQogICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS50cmltKCkgPT09ICIiKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcigiQW5ub3RhdGlvbiBwcm9jZXNzIGZhaWxlZDogZW1wdHkgb3IgbnVsbCByZXNwb25zZSIpOw0KICAgIH0NCg0KICAgIHJldHVybiByZXNwb25zZTsNCn07DQoNCmxldCBlbmhhbmNlID0gYXN5bmMgKCkgPT4gew0KDQogICAgaWYgKCFlcGlEYXRhIHx8ICFlcGlEYXRhLmVudHJ5IHx8IGVwaURhdGEuZW50cnkubGVuZ3RoID09PSAwKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcigiZVBJIGlzIGVtcHR5IG9yIGludmFsaWQuIik7DQogICAgfQ0KICAgIGxldCBsaXN0T2ZDYXRlZ29yaWVzVG9TZWFyY2ggPSBbImdyYXYtMyJdOyAvL3doYXQgdG8gbG9vayBpbiBleHRlbnNpb25zIC1tYWRlIHVwIGNvZGUgYmVjYXVzZSB0aGVyZSBpcyBub25lDQoNCiAgICAvLyBNYXRjaCBsaXN0cw0KICAgIGNvbnN0IEJVTkRMRV9JREVOVElGSUVSX0xJU1QgPSBbImVwaWJ1bmRsZS0xMjMiLCAiZXBpYnVuZGxlLWFiYyJdOw0KICAgIGNvbnN0IFBST0RVQ1RfSURFTlRJRklFUl9MSVNUID0gWyJDSVQtMjA0NDQ3IiwgIlJJUy0xOTczNjEiXTsNCg0KDQogICAgbGV0IG1hdGNoRm91bmQgPSBmYWxzZTsNCg0KICAgIC8vIDEuIENoZWNrIENvbXBvc2l0aW9uLmxhbmd1YWdlDQogICAgZXBpRGF0YS5lbnRyeT8uZm9yRWFjaCgoZW50cnkpID0+IHsNCiAgICAgICAgY29uc3QgcmVzID0gZW50cnkucmVzb3VyY2U7DQogICAgICAgIGlmIChyZXM/LnJlc291cmNlVHlwZSA9PT0gIkNvbXBvc2l0aW9uIiAmJiByZXMubGFuZ3VhZ2UpIHsNCiAgICAgICAgICAgIGxhbmcgPSByZXMubGFuZ3VhZ2U7DQogICAgICAgICAgICBjb25zb2xlLmxvZygiPA0gRGV0ZWN0ZWQgZnJvbSBDb21wb3NpdGlvbi5sYW5ndWFnZToiLCBsYW5nKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICAgLy8gMi4gSWYgbm90IGZvdW5kLCBjaGVjayBCdW5kbGUubGFuZ3VhZ2UNCiAgICBpZiAoIWxhbmcgJiYgZXBpRGF0YS5sYW5ndWFnZSkgew0KICAgICAgICBsYW5nID0gZXBpRGF0YS5sYW5ndWFnZTsNCiAgICAgICAgY29uc29sZS5sb2coIjwNIERldGVjdGVkIGZyb20gQnVuZGxlLmxhbmd1YWdlOiIsIGxhbmcpOw0KICAgIH0NCg0KICAgIC8vIDMuIEZhbGxiYWNrIG1lc3NhZ2UNCiAgICBpZiAoIWxhbmcpIHsNCiAgICAgICAgY29uc29sZS53YXJuKCKgDyBObyBsYW5ndWFnZSBkZXRlY3RlZCBpbiBDb21wb3NpdGlvbiBvciBCdW5kbGUuIik7DQogICAgfQ0KDQogICAgLy8gQ2hlY2sgYnVuZGxlLmlkZW50aWZpZXIudmFsdWUNCiAgICBpZiAoDQogICAgICAgIGVwaURhdGEuaWRlbnRpZmllciAmJg0KICAgICAgICBCVU5ETEVfSURFTlRJRklFUl9MSVNULmluY2x1ZGVzKGVwaURhdGEuaWRlbnRpZmllci52YWx1ZSkNCiAgICApIHsNCiAgICAgICAgY29uc29sZS5sb2coIj0XIE1hdGNoZWQgZVBJIEJ1bmRsZS5pZGVudGlmaWVyOiIsIGVwaURhdGEuaWRlbnRpZmllci52YWx1ZSk7DQogICAgICAgIG1hdGNoRm91bmQgPSB0cnVlOw0KICAgIH0NCg0KICAgIC8vIENoZWNrIE1lZGljaW5hbFByb2R1Y3REZWZpbml0aW9uLmlkZW50aWZpZXIudmFsdWUNCiAgICBlcGlEYXRhLmVudHJ5LmZvckVhY2goKGVudHJ5KSA9PiB7DQogICAgICAgIGNvbnN0IHJlcyA9IGVudHJ5LnJlc291cmNlOw0KICAgICAgICBpZiAocmVzPy5yZXNvdXJjZVR5cGUgPT09ICJNZWRpY2luYWxQcm9kdWN0RGVmaW5pdGlvbiIpIHsNCiAgICAgICAgICAgIGNvbnN0IGlkcyA9IHJlcy5pZGVudGlmaWVyIHx8IFtdOw0KICAgICAgICAgICAgaWRzLmZvckVhY2goKGlkKSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKFBST0RVQ1RfSURFTlRJRklFUl9MSVNULmluY2x1ZGVzKGlkLnZhbHVlKSkgew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiPYogTWF0Y2hlZCBNZWRpY2luYWxQcm9kdWN0RGVmaW5pdGlvbi5pZGVudGlmaWVyOiIsIGlkLnZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgbWF0Y2hGb3VuZCA9IHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9KTsNCg0KICAgIC8vIGVQSSB0cmFzbGF0aW9uIGZyb20gdGVybWlub2xvZ3kgY29kZXMgdG8gdGhlaXIgaHVtYW4gcmVkYWJsZSB0cmFuc2xhdGlvbnMgaW4gdGhlIHNlY3Rpb25zDQogICAgLy8gaW4gdGhpcyBjYXNlLCBpZiBpcyBkb2VzIG5vdCBmaW5kIGEgcGxhY2UsIGFkZHMgaXQgdG8gdGhlIHRvcCBvZiB0aGUgZVBJDQogICAgbGV0IGNvbXBvc2l0aW9ucyA9IDA7DQogICAgbGV0IGNhdGVnb3JpZXMgPSBbXTsNCiAgICBlcGkuZW50cnkuZm9yRWFjaCgoZW50cnkpID0+IHsNCiAgICAgICAgaWYgKGVudHJ5LnJlc291cmNlLnJlc291cmNlVHlwZSA9PSAiQ29tcG9zaXRpb24iKSB7DQogICAgICAgICAgICBjb21wb3NpdGlvbnMrKzsNCiAgICAgICAgICAgIC8vSXRlcmF0ZWQgdGhyb3VnaCB0aGUgQ29uZGl0aW9uIGVsZW1lbnQgc2VhcmNoaW5nIGZvciBjb25kaXRpb25zDQogICAgICAgICAgICBlbnRyeS5yZXNvdXJjZS5leHRlbnNpb24uZm9yRWFjaCgoZWxlbWVudCkgPT4gew0KDQogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIHBvc2l0aW9uIG9mIHRoZSBleHRlbnNpb25bMV0gaXMgY29ycmVjdA0KICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmV4dGVuc2lvblsxXS51cmwgPT0gImNvbmNlcHQiKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIFNlYXJjaCB0aHJvdWdoIHRoZSBkaWZmZXJlbnQgdGVybWlub2xvZ2llcyB0aGF0IG1heSBiZSBhdmFpYmxlIHRvIGNoZWNrIGluIHRoZSBjb25kaXRpb24NCiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuZXh0ZW5zaW9uWzFdLnZhbHVlQ29kZWFibGVSZWZlcmVuY2UuY29uY2VwdCAhPSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZXh0ZW5zaW9uWzFdLnZhbHVlQ29kZWFibGVSZWZlcmVuY2UuY29uY2VwdC5jb2RpbmcuZm9yRWFjaCgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29kaW5nKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJFeHRlbnNpb246ICIgKyBlbGVtZW50LmV4dGVuc2lvblswXS52YWx1ZVN0cmluZyArICI6IiArIGNvZGluZy5jb2RlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgY29kZSBpcyBpbiB0aGUgbGlzdCBvZiBjYXRlZ29yaWVzIHRvIHNlYXJjaA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGlzdE9mQ2F0ZWdvcmllc1RvU2VhcmNoLmluY2x1ZGVzKGNvZGluZy5jb2RlKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNhdGVnb3J5IGlzIGFscmVhZHkgaW4gdGhlIGxpc3Qgb2YgY2F0ZWdvcmllcw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcmllcy5wdXNoKGVsZW1lbnQuZXh0ZW5zaW9uWzBdLnZhbHVlU3RyaW5nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIGlmIChjb21wb3NpdGlvbnMgPT0gMCkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCBlUEk6IG5vIGNhdGVnb3J5ICJDb21wb3NpdGlvbiIgZm91bmQnKTsNCiAgICB9DQoNCiAgICBpZiAoIW1hdGNoRm91bmQpIHsNCiAgICAgICAgY29uc29sZS5sb2coImVQSSBpcyBub3QgZm9yIGEgaGlnaC1yaXNrIHNpZGUgZWZmZWN0IG1lZGljYXRpb24iKTsNCiAgICAgICAgbGlua0FkZGVkID0gZmFsc2U7DQogICAgICAgIHJldHVybiBodG1sRGF0YTsNCiAgICB9DQoNCiAgICBlbHNlIHsNCiAgICAgICAgbGlua0FkZGVkID0gdHJ1ZTsNCg0KICAgICAgICBsZXQgcmVzcG9uc2UgPSBodG1sRGF0YTsNCiAgICAgICAgbGV0IGRvY3VtZW50Ow0KDQogICAgICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAidW5kZWZpbmVkIikgew0KICAgICAgICAgICAgbGV0IGpzZG9tID0gYXdhaXQgaW1wb3J0KCJqc2RvbSIpOw0KICAgICAgICAgICAgbGV0IHsgSlNET00gfSA9IGpzZG9tOw0KICAgICAgICAgICAgbGV0IGRvbSA9IG5ldyBKU0RPTShodG1sRGF0YSk7DQogICAgICAgICAgICBkb2N1bWVudCA9IGRvbS53aW5kb3cuZG9jdW1lbnQ7DQogICAgICAgICAgICByZXR1cm4gaW5zZXJ0UXVlc3Rpb25uYWlyZUxpbmsoY2F0ZWdvcmllcywgbGFuZywgZG9jdW1lbnQsIHJlc3BvbnNlKTsNCiAgICAgICAgICAgIC8vbGlzdE9mQ2F0ZWdvcmllcywgZW5oYW5jZVRhZywgZG9jdW1lbnQsIHJlc3BvbnNlDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBkb2N1bWVudCA9IHdpbmRvdy5kb2N1bWVudDsNCiAgICAgICAgICAgIHJldHVybiBpbnNlcnRRdWVzdGlvbm5haXJlTGluayhjYXRlZ29yaWVzLCBsYW5nLCBkb2N1bWVudCwgcmVzcG9uc2UpOw0KICAgICAgICB9DQogICAgfTsNCn07DQoNCg0KZnVuY3Rpb24gZ2V0UmVwb3J0KGxhbmcpIHsNCiAgICBjb25zb2xlLmxvZygiR2VuZXJhdGluZyByZXBvcnQgaW4gbGFuZ3VhZ2U6IiwgbGFuZyk7DQogICAgcmV0dXJuIHsgbWVzc2FnZTogZ2V0RXhwbGFuYXRpb24obGFuZyksIHN0YXR1czogIiIgfTsNCg0KDQp9DQoNCmxldCBleHBsYW5hdGlvbiA9ICgpID0+IHsNCiAgICAvLyBFeHRyYWN0IGxhbmd1YWdlIGZyb20gZVBJDQogICAgbGV0IGxhbmd1YWdlID0gImVuIjsgLy8gZGVmYXVsdCB0byBFbmdsaXNoDQogICAgaWYgKGVwaURhdGEgJiYgZXBpRGF0YS5sYW5ndWFnZSkgew0KICAgICAgICBsYW5ndWFnZSA9IGVwaURhdGEubGFuZ3VhZ2UudG9Mb3dlckNhc2UoKTsNCiAgICB9DQoNCiAgICAvLyBTaW1wbGUsIHBhdGllbnQtZnJpZW5kbHkgZXhwbGFuYXRpb25zIGluIGRpZmZlcmVudCBsYW5ndWFnZXMNCiAgICBjb25zdCBleHBsYW5hdGlvbnNBZGRlZCA9IHsNCiAgICAgICAgZW46ICJBIGxpbmsgdG8gYSBzYWZldHkgcXVlc3Rpb25uYWlyZSBoYXMgYmVlbiBhZGRlZCB0byBoZWxwIHlvdSBhc3Nlc3MgaWYgdGhpcyBtZWRpY2F0aW9uIGlzIHNhZmUgZm9yIHlvdS4iLA0KICAgICAgICBlczogIlNlIGhhIGHxYWRpZG8gdW4gZW5sYWNlIGEgdW4gY3Vlc3Rpb25hcmlvIGRlIHNlZ3VyaWRhZCBwYXJhIGF5dWRhcmxlIGEgZXZhbHVhciBzaSBlc3RlIG1lZGljYW1lbnRvIGVzIHNlZ3VybyBwYXJhIHVzdGVkLiIsDQogICAgICAgIGZyOiAiVW4gbGllbiB2ZXJzIHVuIHF1ZXN0aW9ubmFpcmUgZGUgc+ljdXJpdOkgYSDpdOkgYWpvdXTpIHBvdXIgdm91cyBhaWRlciDgIOl2YWx1ZXIgc2kgY2UgbelkaWNhbWVudCBlc3Qgc/tyIHBvdXIgdm91cy4iLA0KICAgICAgICBkZTogIkVpbiBMaW5rIHp1IGVpbmVtIFNpY2hlcmhlaXRzZnJhZ2Vib2dlbiB3dXJkZSBoaW56dWdlZvxndCwgdW0gSWhuZW4genUgaGVsZmVuIGZlc3R6dXN0ZWxsZW4sIG9iIGRpZXNlcyBNZWRpa2FtZW50IGb8ciBTaWUgc2ljaGVyIGlzdC4iLA0KICAgICAgICBpdDogIsggc3RhdG8gYWdnaXVudG8gdW4gY29sbGVnYW1lbnRvIGEgdW4gcXVlc3Rpb25hcmlvIGRpIHNpY3VyZXp6YSBwZXIgYWl1dGFydGkgYSB2YWx1dGFyZSBzZSBxdWVzdG8gZmFybWFjbyDoIHNpY3VybyBwZXIgdGUuIiwNCiAgICAgICAgcHQ6ICJGb2kgYWRpY2lvbmFkbyB1bSBsaW5rIHBhcmEgdW0gcXVlc3Rpb27hcmlvIGRlIHNlZ3VyYW7nYSBwYXJhIGFqdWThLWxvIGEgYXZhbGlhciBzZSBlc3RlIG1lZGljYW1lbnRvIOkgc2VndXJvIHBhcmEgdm9j6i4iLA0KICAgICAgICBubDogIkVyIGlzIGVlbiBsaW5rIG5hYXIgZWVuIHZlaWxpZ2hlaWRzdnJhZ2VubGlqc3QgdG9lZ2V2b2VnZCBvbSB1IHRlIGhlbHBlbiBiZW9vcmRlbGVuIG9mIGRpdCBtZWRpY2lqbiB2ZWlsaWcgdm9vciB1IGlzLiINCiAgICB9Ow0KDQogICAgY29uc3QgZXhwbGFuYXRpb25zTm90QWRkZWQgPSB7DQogICAgICAgIGVuOiAiWW91ciBwcm9maWxlIGRvZXMgbm90IG1hdGNoIHRoZSBjb25kaXRpb25zIHRvIGFkZCBhIHF1ZXN0aW9ubmFpcmUgbGluay4iLA0KICAgICAgICBlczogIlN1IHBlcmZpbCBubyBjb2luY2lkZSBjb24gbGFzIGNvbmRpY2lvbmVzIHBhcmEgYfFhZGlyIHVuIGVubGFjZSBhbCBjdWVzdGlvbmFyaW8uIiwNCiAgICAgICAgZnI6ICJWb3RyZSBwcm9maWwgbmUgY29ycmVzcG9uZCBwYXMgYXV4IGNvbmRpdGlvbnMgcG91ciBham91dGVyIHVuIGxpZW4gdmVycyBsZSBxdWVzdGlvbm5haXJlLiIsDQogICAgICAgIGRlOiAiSWhyIFByb2ZpbCBlcmb8bGx0IG5pY2h0IGRpZSBCZWRpbmd1bmdlbiBm/HIgZGFzIEhpbnp1ZvxnZW4gZWluZXMgRnJhZ2Vib2dlbi1MaW5rcy4iLA0KICAgICAgICBpdDogIklsIHR1byBwcm9maWxvIG5vbiBjb3JyaXNwb25kZSBhbGxlIGNvbmRpemlvbmkgcGVyIGFnZ2l1bmdlcmUgdW4gY29sbGVnYW1lbnRvIGFsIHF1ZXN0aW9uYXJpby4iLA0KICAgICAgICBwdDogIlNldSBwZXJmaWwgbuNvIGNvcnJlc3BvbmRlIOBzIGNvbmRp5/VlcyBwYXJhIGFkaWNpb25hciB1bSBsaW5rIHBhcmEgbyBxdWVzdGlvbuFyaW8uIiwNCiAgICAgICAgbmw6ICJVdyBwcm9maWVsIHZvbGRvZXQgbmlldCBhYW4gZGUgdm9vcndhYXJkZW4gb20gZWVuIHZyYWdlbmxpanN0bGluayB0b2UgdGUgdm9lZ2VuLiINCiAgICB9Ow0KDQogICAgLy8gUmV0dXJuIGV4cGxhbmF0aW9uIGJhc2VkIG9uIHdoZXRoZXIgbGluayB3YXMgYWRkZWQsIGluIHRoZSBlUEkgbGFuZ3VhZ2UNCiAgICBpZiAobGlua0FkZGVkKSB7DQogICAgICAgIHJldHVybiBleHBsYW5hdGlvbnNBZGRlZFtsYW5ndWFnZV0gfHwgZXhwbGFuYXRpb25zQWRkZWQuZW47DQogICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIGV4cGxhbmF0aW9uc05vdEFkZGVkW2xhbmd1YWdlXSB8fCBleHBsYW5hdGlvbnNOb3RBZGRlZC5lbjsNCiAgICB9DQp9Ow0KDQpyZXR1cm4gew0KICAgIGVuaGFuY2U6IGVuaGFuY2UsDQogICAgZ2V0U3BlY2lmaWNhdGlvbjogZ2V0U3BlY2lmaWNhdGlvbiwNCiAgICBleHBsYW5hdGlvbjogKGxhbmd1YWdlKSA9PiBnZXRFeHBsYW5hdGlvbihsYW5ndWFnZSB8fCBsYW5nKSwNCiAgICByZXBvcnQ6IChsYW5ndWFnZSkgPT4gZ2V0UmVwb3J0KGxhbmd1YWdlIHx8IGxhbmcpLA0KfTsNCg0KDQo="
    }
  ]
}