{
  "resourceType": "Library",
  "meta": {
    "profile": [
      "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lens"
    ]
  },
  "extension": [
    {
      "url": "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lee-version",
      "valueString": "dev"
    }
  ],
  "url": "https://gravitate-health.lst.tfo.upm.es/ips/api/fhir/Library/592",
  "identifier": [
    {
      "system": "http://gravitate-health.lst.tfo.upm.es",
      "value": "questionnaire-lens"
    }
  ],
  "version": "0.0.1",
  "name": "Interaction Lens",
  "_name": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente de Interacci\u00f3n"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente de Intera\u00e7\u00e3o"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Interaktionslinse"
          }
        ]
      }
    ]
  },
  "date": "2024-06-12T13:40:03.690Z",
  "title": "Interaction Lens",
  "_title": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente de Interacci\u00f3n"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente de Intera\u00e7\u00e3o"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Interaktionslinse"
          }
        ]
      }
    ]
  },
  "status": "draft",
  "experimental": true,
  "type": {
    "coding": [
      {
        "code": "logical-library"
      }
    ]
  },
  "publisher": "Gravitate Health Project - UPM Team",
  "contact": [
    {
      "name": "Gravitate Health",
      "telecom": [
        {
          "system": "url",
          "value": "https://www.gravitatehealth.eu/"
        }
      ]
    }
  ],
  "description": "A lens that highlight any information related to interactions between other mediciones or ePIs",
  "_description": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Una lente que resalta cualquier informaci\u00f3n relacionada con interacciones entre otros medicamentos o ePIs."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Uma lente que destaca qualquer informa\u00e7\u00e3o relacionada com intera\u00e7\u00f5es entre outros medicamentos ou ePIs."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "En linse, der fremh\u00e6ver al information relateret til interaktioner mellem andre l\u00e6gemidler eller ePI'er."
          }
        ]
      }
    ]
  },
  "jurisdiction": [
    {
      "coding": [
        {
          "code": "EU",
          "system": "urn:iso:std:iso:3166"
        }
      ]
    }
  ],
  "purpose": "Clarify the important things related to interactions between other ePIs in the ePI provided",
  "_purpose": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Aclarar los aspectos importantes relacionados con interacciones entre otros ePIs en el ePI proporcionado."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Esclarecer os pontos importantes relacionados com intera\u00e7\u00f5es entre outros ePIs no ePI fornecido."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Klarg\u00f8r de vigtige ting vedr\u00f8rende interaktioner mellem andre ePI'er i den angivne ePI."
          }
        ]
      }
    ]
  },
  "usage": "This lens requires a preprocessed ePI, and an IPS to work. You can import this lens directly to your FHIR Server which suports Library Resource type.",
  "_usage": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Esta lente requiere una ePI preprocesada y un IPS para funcionar. Puedes importar esta lente directamente en tu servidor FHIR que soporte el tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Esta lente requer uma ePI pr\u00e9-processada e um IPS para funcionar. Podes importar esta lente diretamente para o teu servidor FHIR que suporte o tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Denne linse kr\u00e6ver en forbehandlet ePI og en IPS for at fungere. Du kan importere denne linse direkte til din FHIR-server, som underst\u00f8tter ressource-typen Library."
          }
        ]
      }
    ]
  },
  "copyright": "\u00a9 2024 Gravitate Health",
  "parameter": [
    {
      "use": "in",
      "documentation": "parameter if it exists",
      "type": "CodeableConcept"
    }
  ],
  "content": [
    {
      "contentType": "application/javascript",
      "data": ""
    }
  ],
  "data": "bGV0IHB2RGF0YSA9IHB2OwpsZXQgaHRtbERhdGEgPSBodG1sOwoKbGV0IGVwaURhdGEgPSBlcGk7CmxldCBpcHNEYXRhID0gaXBzOwoKbGV0IGdldFNwZWNpZmljYXRpb24gPSAoKSA9PiB7CiAgICByZXR1cm4gIjIuMC4zLXF1ZXN0aW9ubmFpcmUtYmFubmVyIjsKfTsKLy9kb2N1bWVudCwgaHRtbERhdGEsIGJhbm5lckhUTUwKLy8KY29uc3QgaW5zZXJ0UXVlc3Rpb25uYWlyZUxpbmsgPSAobGlzdE9mQ2F0ZWdvcmllcywgbGFuZ3VhZ2UsIGRvY3VtZW50LCByZXNwb25zZSkgPT4gewoKICAgIGlmIChsYW5ndWFnZT8uc3RhcnRzV2l0aCgicHQiKSkgewogICAgICAgIGxpbmtIVE1MID0gImh0dHBzOi8vZXhhbXBsZS5vcmcvcXVlc3Rpb25uYWlyZS9oaWdoLXJpc2siOwoKICAgIH0gZWxzZSBpZiAobGFuZ3VhZ2U/LnN0YXJ0c1dpdGgoImVuIikpIHsKICAgICAgICBsaW5rSFRNTCA9ICJodHRwczovL2V4YW1wbGUub3JnL3F1ZXN0aW9ubmFpcmUvaGlnaC1yaXNrIjsKCiAgICB9IGVsc2UgaWYgKGxhbmd1YWdlPy5zdGFydHNXaXRoKCJlcyIpKSB7CiAgICAgICAgbGlua0hUTUwgPSAiaHR0cHM6Ly9leGFtcGxlLm9yZy9xdWVzdGlvbm5haXJlL2hpZ2gtcmlzayI7CgogICAgfSBlbHNlIGlmIChsYW5ndWFnZT8uc3RhcnRzV2l0aCgiZGEiKSkgewogICAgICAgIGxpbmtIVE1MID0gImh0dHBzOi8vZXhhbXBsZS5vcmcvcXVlc3Rpb25uYWlyZS9oaWdoLXJpc2siOwoKICAgIH0gZWxzZSB7CiAgICAgICAgbGlua0hUTUwgPSAiaHR0cHM6Ly9leGFtcGxlLm9yZy9xdWVzdGlvbm5haXJlL2hpZ2gtcmlzayI7CgogICAgfQogICAgbGV0IHNob3VsZEFwcGVuZCA9IGZhbHNlOyAvL2ZvciBmdXR1cmUgdXNhZ2UKICAgIGxldCBmb3VuZENhdGVnb3J5ID0gZmFsc2U7CiAgICBjb25zb2xlLmxvZyhsaXN0T2ZDYXRlZ29yaWVzKQogICAgY29uc29sZS5sb2cobGlzdE9mQ2F0ZWdvcmllcy5sZW5ndGgpCiAgICBsaXN0T2ZDYXRlZ29yaWVzLmZvckVhY2goKGNsYXNzTmFtZSkgPT4gewogICAgICAgIGlmICgKICAgICAgICAgICAgcmVzcG9uc2UuaW5jbHVkZXMoYGNsYXNzPSIke2NsYXNzTmFtZX1gKSB8fAogICAgICAgICAgICByZXNwb25zZS5pbmNsdWRlcyhgY2xhc3M9JyR7Y2xhc3NOYW1lfWApCiAgICAgICAgKSB7CiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShjbGFzc05hbWUpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlbCA9IGVsZW1lbnRzW2ldOwogICAgICAgICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJocmVmIiwgbGlua0hUTUwpOwogICAgICAgICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoInRhcmdldCIsICJfYmxhbmsiKTsKICAgICAgICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJjbGFzcyIsICJxdWVzdGlvbm5haXJlLWxlbnMiKTsKCiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkQXBwZW5kKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQXBwZW5kIHRoZSBsaW5rIGFzIGEgbmV3IGVsZW1lbnQgaW5zaWRlIHRoZSBleGlzdGluZyBlbGVtZW50CiAgICAgICAgICAgICAgICAgICAgbGluay5pbm5lckhUTUwgPSAi8J+TnSBGaWxsIG91dCBzYWZldHkgcXVlc3Rpb25uYWlyZSI7CiAgICAgICAgICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIFdyYXAgdGhlIGV4aXN0aW5nIGNvbnRlbnRzIG9mIHRoZSBlbGVtZW50IGluIHRoZSBsaW5rCiAgICAgICAgICAgICAgICAgICAgbGluay5pbm5lckhUTUwgPSBlbC5pbm5lckhUTUw7CiAgICAgICAgICAgICAgICAgICAgZWwuaW5uZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm91bmRDYXRlZ29yeSA9IHRydWU7CiAgICAgICAgfQogICAgfSk7CgogICAgLy8gTm8gbWF0Y2hpbmcgY2F0ZWdvcnkgdGFncyDihpIgaW5qZWN0IGJhbm5lciBhdCB0b3AKICAgIGlmICghZm91bmRDYXRlZ29yeSkgewoKICAgICAgICBjb25zdCBiYW5uZXJEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCiAgICAgICAgaWYgKGxhbmd1YWdlPy5zdGFydHNXaXRoKCJwdCIpKSB7CiAgICAgICAgICAgIGJhbm5lckRpdi5pbm5lckhUTUwgPSBgCiAgICAgICA8ZGl2IGNsYXNzPSJhbGVydC1iYW5uZXIgcXVlc3Rpb25uYWlyZS1sZW5zIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZmZkZGRkO3BhZGRpbmc6MWVtO2JvcmRlcjoxcHggc29saWQgI2ZmODg4ODttYXJnaW4tYm90dG9tOjFlbTsiPgogIOKaoO+4jyBFc3RlIG1lZGljYW1lbnRvIHBvZGUgY2F1c2FyIGVmZWl0b3Mgc2VjdW5kw6FyaW9zIGRlIGFsdG8gcmlzY28uCiAgPGEgaHJlZj0iJHtsaW5rSFRNTH0iIHRhcmdldD0iX2JsYW5rIiBzdHlsZT0ibWFyZ2luLWxlZnQ6IDFlbTsiPlByZWVuY2hlciBxdWVzdGlvbsOhcmlvIGRlIHNlZ3VyYW7Dp2E8L2E+CjwvZGl2PgogICAgICBgOwoKICAgICAgICB9IGVsc2UgaWYgKGxhbmd1YWdlPy5zdGFydHNXaXRoKCJlbiIpKSB7CiAgICAgICAgICAgIGJhbm5lckRpdi5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0iYWxlcnQtYmFubmVyIHF1ZXN0aW9ubmFpcmUtbGVucyIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6I2ZmZGRkZDtwYWRkaW5nOjFlbTtib3JkZXI6MXB4IHNvbGlkICNmZjg4ODg7bWFyZ2luLWJvdHRvbToxZW07Ij4KICAgICAgICAgIOKaoO+4jyBUaGlzIG1lZGljYXRpb24gbWF5IGNhdXNlIGhpZ2gtcmlzayBzaWRlIGVmZmVjdHMuCiAgICAgICAgICA8YSBocmVmPSIke2xpbmtIVE1MfSIgdGFyZ2V0PSJfYmxhbmsiIHN0eWxlPSJtYXJnaW4tbGVmdDogMWVtOyI+RmlsbCBvdXQgc2FmZXR5IHF1ZXN0aW9ubmFpcmU8L2E+CiAgICAgICAgPC9kaXY+CiAgICAgIGA7CgogICAgICAgIH0gZWxzZSBpZiAobGFuZ3VhZ2U/LnN0YXJ0c1dpdGgoImVzIikpIHsKICAgICAgICAgICAgYmFubmVyRGl2LmlubmVySFRNTCA9IGAKICAgICAgIDxkaXYgY2xhc3M9ImFsZXJ0LWJhbm5lciBxdWVzdGlvbm5haXJlLWxlbnMiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiNmZmRkZGQ7cGFkZGluZzoxZW07Ym9yZGVyOjFweCBzb2xpZCAjZmY4ODg4O21hcmdpbi1ib3R0b206MWVtOyI+CiAg4pqg77iPIEVzdGUgbWVkaWNhbWVudG8gcHVlZGUgY2F1c2FyIGVmZWN0b3Mgc2VjdW5kYXJpb3MgZGUgYWx0byByaWVzZ28uCiAgPGEgaHJlZj0iJHtsaW5rSFRNTH0iIHRhcmdldD0iX2JsYW5rIiBzdHlsZT0ibWFyZ2luLWxlZnQ6IDFlbTsiPlJlbGxlbmFyIGN1ZXN0aW9uYXJpbyBkZSBzZWd1cmlkYWQ8L2E+CjwvZGl2PgogICAgICBgOwogICAgICAgIH0gZWxzZSBpZiAobGFuZ3VhZ2U/LnN0YXJ0c1dpdGgoImRhIikpIHsKICAgICAgICAgICAgYmFubmVyRGl2LmlubmVySFRNTCA9IGAKICAgICAgPGRpdiBjbGFzcz0iYWxlcnQtYmFubmVyIHF1ZXN0aW9ubmFpcmUtbGVucyIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6I2ZmZGRkZDtwYWRkaW5nOjFlbTtib3JkZXI6MXB4IHNvbGlkICNmZjg4ODg7bWFyZ2luLWJvdHRvbToxZW07Ij4KICDimqDvuI8gRGVubmUgbWVkaWNpbiBrYW4gZm9yw6Vyc2FnZSBhbHZvcmxpZ2UgYml2aXJrbmluZ2VyLgogIDxhIGhyZWY9IiR7bGlua0hUTUx9IiB0YXJnZXQ9Il9ibGFuayIgc3R5bGU9Im1hcmdpbi1sZWZ0OiAxZW07Ij5VZGZ5bGQgc2lra2VyaGVkc3Nww7hyZ2Vza2VtYTwvYT4KPC9kaXY+CiAgICAgIGA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYmFubmVyRGl2LmlubmVySFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJhbGVydC1iYW5uZXIgcXVlc3Rpb25uYWlyZS1sZW5zIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZmZkZGRkO3BhZGRpbmc6MWVtO2JvcmRlcjoxcHggc29saWQgI2ZmODg4ODttYXJnaW4tYm90dG9tOjFlbTsiPgogICAgICAgICAg4pqg77iPIFRoaXMgbWVkaWNhdGlvbiBtYXkgY2F1c2UgaGlnaC1yaXNrIHNpZGUgZWZmZWN0cy4KICAgICAgICAgIDxhIGhyZWY9IiR7bGlua0hUTUx9IiB0YXJnZXQ9Il9ibGFuayIgc3R5bGU9Im1hcmdpbi1sZWZ0OiAxZW07Ij5GaWxsIG91dCBzYWZldHkgcXVlc3Rpb25uYWlyZTwvYT4KICAgICAgICA8L2Rpdj4KICAgICAgYDsKCiAgICAgICAgfQoKCgogICAgICAgIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJib2R5Iik7CiAgICAgICAgaWYgKGJvZHkpIHsKICAgICAgICAgICAgYm9keS5pbnNlcnRCZWZvcmUoYmFubmVyRGl2LCBib2R5LmZpcnN0Q2hpbGQpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBDbGVhbiBoZWFkIChzYW1lIGFzIHlvdXIgb3JpZ2luYWwgbG9naWMpCiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKS5sZW5ndGggPiAwKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXS5yZW1vdmUoKTsKICAgIH0KCiAgICAvLyBFeHRyYWN0IEhUTUwgcmVzdWx0CiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKS5sZW5ndGggPiAwKSB7CiAgICAgICAgcmVzcG9uc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdLmlubmVySFRNTDsKICAgICAgICBjb25zb2xlLmxvZygiUmVzcG9uc2U6ICIgKyByZXNwb25zZSk7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKCJSZXNwb25zZTogIiArIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5pbm5lckhUTUwpOwogICAgICAgIHJlc3BvbnNlID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmlubmVySFRNTDsKICAgIH0KCiAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnRyaW0oKSA9PT0gIiIpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFubm90YXRpb24gcHJvY2VzcyBmYWlsZWQ6IGVtcHR5IG9yIG51bGwgcmVzcG9uc2UiKTsKICAgIH0KCiAgICByZXR1cm4gcmVzcG9uc2U7Cn07CgpsZXQgZW5oYW5jZSA9IGFzeW5jICgpID0+IHsKCiAgICBpZiAoIWVwaURhdGEgfHwgIWVwaURhdGEuZW50cnkgfHwgZXBpRGF0YS5lbnRyeS5sZW5ndGggPT09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImVQSSBpcyBlbXB0eSBvciBpbnZhbGlkLiIpOwogICAgfQogICAgbGV0IGxpc3RPZkNhdGVnb3JpZXNUb1NlYXJjaCA9IFsiZ3Jhdi0zIl07IC8vd2hhdCB0byBsb29rIGluIGV4dGVuc2lvbnMgLW1hZGUgdXAgY29kZSBiZWNhdXNlIHRoZXJlIGlzIG5vbmUKCiAgICAvLyBNYXRjaCBsaXN0cwogICAgY29uc3QgQlVORExFX0lERU5USUZJRVJfTElTVCA9IFsiZXBpYnVuZGxlLTEyMyIsICJlcGlidW5kbGUtYWJjIl07CiAgICBjb25zdCBQUk9EVUNUX0lERU5USUZJRVJfTElTVCA9IFsiQ0lULTIwNDQ0NyIsICJSSVMtMTk3MzYxIl07CgoKICAgIGxldCBtYXRjaEZvdW5kID0gZmFsc2U7CiAgICBsZXQgbGFuZ3VhZ2VEZXRlY3RlZCA9IG51bGw7CgogICAgLy8gMS4gQ2hlY2sgQ29tcG9zaXRpb24ubGFuZ3VhZ2UKICAgIGVwaURhdGEuZW50cnk/LmZvckVhY2goKGVudHJ5KSA9PiB7CiAgICAgICAgY29uc3QgcmVzID0gZW50cnkucmVzb3VyY2U7CiAgICAgICAgaWYgKHJlcz8ucmVzb3VyY2VUeXBlID09PSAiQ29tcG9zaXRpb24iICYmIHJlcy5sYW5ndWFnZSkgewogICAgICAgICAgICBsYW5ndWFnZURldGVjdGVkID0gcmVzLmxhbmd1YWdlOwogICAgICAgICAgICBjb25zb2xlLmxvZygi8J+MjSBEZXRlY3RlZCBmcm9tIENvbXBvc2l0aW9uLmxhbmd1YWdlOiIsIGxhbmd1YWdlRGV0ZWN0ZWQpOwogICAgICAgIH0KICAgIH0pOwoKICAgIC8vIDIuIElmIG5vdCBmb3VuZCwgY2hlY2sgQnVuZGxlLmxhbmd1YWdlCiAgICBpZiAoIWxhbmd1YWdlRGV0ZWN0ZWQgJiYgZXBpRGF0YS5sYW5ndWFnZSkgewogICAgICAgIGxhbmd1YWdlRGV0ZWN0ZWQgPSBlcGlEYXRhLmxhbmd1YWdlOwogICAgICAgIGNvbnNvbGUubG9nKCLwn4yNIERldGVjdGVkIGZyb20gQnVuZGxlLmxhbmd1YWdlOiIsIGxhbmd1YWdlRGV0ZWN0ZWQpOwogICAgfQoKICAgIC8vIDMuIEZhbGxiYWNrIG1lc3NhZ2UKICAgIGlmICghbGFuZ3VhZ2VEZXRlY3RlZCkgewogICAgICAgIGNvbnNvbGUud2Fybigi4pqg77iPIE5vIGxhbmd1YWdlIGRldGVjdGVkIGluIENvbXBvc2l0aW9uIG9yIEJ1bmRsZS4iKTsKICAgIH0KCiAgICAvLyBDaGVjayBidW5kbGUuaWRlbnRpZmllci52YWx1ZQogICAgaWYgKAogICAgICAgIGVwaURhdGEuaWRlbnRpZmllciAmJgogICAgICAgIEJVTkRMRV9JREVOVElGSUVSX0xJU1QuaW5jbHVkZXMoZXBpRGF0YS5pZGVudGlmaWVyLnZhbHVlKQogICAgKSB7CiAgICAgICAgY29uc29sZS5sb2coIvCflJcgTWF0Y2hlZCBlUEkgQnVuZGxlLmlkZW50aWZpZXI6IiwgZXBpRGF0YS5pZGVudGlmaWVyLnZhbHVlKTsKICAgICAgICBtYXRjaEZvdW5kID0gdHJ1ZTsKICAgIH0KCiAgICAvLyBDaGVjayBNZWRpY2luYWxQcm9kdWN0RGVmaW5pdGlvbi5pZGVudGlmaWVyLnZhbHVlCiAgICBlcGlEYXRhLmVudHJ5LmZvckVhY2goKGVudHJ5KSA9PiB7CiAgICAgICAgY29uc3QgcmVzID0gZW50cnkucmVzb3VyY2U7CiAgICAgICAgaWYgKHJlcz8ucmVzb3VyY2VUeXBlID09PSAiTWVkaWNpbmFsUHJvZHVjdERlZmluaXRpb24iKSB7CiAgICAgICAgICAgIGNvbnN0IGlkcyA9IHJlcy5pZGVudGlmaWVyIHx8IFtdOwogICAgICAgICAgICBpZHMuZm9yRWFjaCgoaWQpID0+IHsKICAgICAgICAgICAgICAgIGlmIChQUk9EVUNUX0lERU5USUZJRVJfTElTVC5pbmNsdWRlcyhpZC52YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygi8J+SiiBNYXRjaGVkIE1lZGljaW5hbFByb2R1Y3REZWZpbml0aW9uLmlkZW50aWZpZXI6IiwgaWQudmFsdWUpOwogICAgICAgICAgICAgICAgICAgIG1hdGNoRm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9KTsKCiAgICAvLyBlUEkgdHJhc2xhdGlvbiBmcm9tIHRlcm1pbm9sb2d5IGNvZGVzIHRvIHRoZWlyIGh1bWFuIHJlZGFibGUgdHJhbnNsYXRpb25zIGluIHRoZSBzZWN0aW9ucwogICAgLy8gaW4gdGhpcyBjYXNlLCBpZiBpcyBkb2VzIG5vdCBmaW5kIGEgcGxhY2UsIGFkZHMgaXQgdG8gdGhlIHRvcCBvZiB0aGUgZVBJCiAgICBsZXQgY29tcG9zaXRpb25zID0gMDsKICAgIGxldCBjYXRlZ29yaWVzID0gW107CiAgICBlcGkuZW50cnkuZm9yRWFjaCgoZW50cnkpID0+IHsKICAgICAgICBpZiAoZW50cnkucmVzb3VyY2UucmVzb3VyY2VUeXBlID09ICJDb21wb3NpdGlvbiIpIHsKICAgICAgICAgICAgY29tcG9zaXRpb25zKys7CiAgICAgICAgICAgIC8vSXRlcmF0ZWQgdGhyb3VnaCB0aGUgQ29uZGl0aW9uIGVsZW1lbnQgc2VhcmNoaW5nIGZvciBjb25kaXRpb25zCiAgICAgICAgICAgIGVudHJ5LnJlc291cmNlLmV4dGVuc2lvbi5mb3JFYWNoKChlbGVtZW50KSA9PiB7CgogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIHBvc2l0aW9uIG9mIHRoZSBleHRlbnNpb25bMV0gaXMgY29ycmVjdAogICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuZXh0ZW5zaW9uWzFdLnVybCA9PSAiY29uY2VwdCIpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTZWFyY2ggdGhyb3VnaCB0aGUgZGlmZmVyZW50IHRlcm1pbm9sb2dpZXMgdGhhdCBtYXkgYmUgYXZhaWJsZSB0byBjaGVjayBpbiB0aGUgY29uZGl0aW9uCiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuZXh0ZW5zaW9uWzFdLnZhbHVlQ29kZWFibGVSZWZlcmVuY2UuY29uY2VwdCAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5leHRlbnNpb25bMV0udmFsdWVDb2RlYWJsZVJlZmVyZW5jZS5jb25jZXB0LmNvZGluZy5mb3JFYWNoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvZGluZykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJFeHRlbnNpb246ICIgKyBlbGVtZW50LmV4dGVuc2lvblswXS52YWx1ZVN0cmluZyArICI6IiArIGNvZGluZy5jb2RlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBjb2RlIGlzIGluIHRoZSBsaXN0IG9mIGNhdGVnb3JpZXMgdG8gc2VhcmNoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3RPZkNhdGVnb3JpZXNUb1NlYXJjaC5pbmNsdWRlcyhjb2RpbmcuY29kZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNhdGVnb3J5IGlzIGFscmVhZHkgaW4gdGhlIGxpc3Qgb2YgY2F0ZWdvcmllcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRlZ29yaWVzLnB1c2goZWxlbWVudC5leHRlbnNpb25bMF0udmFsdWVTdHJpbmcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwogICAgaWYgKGNvbXBvc2l0aW9ucyA9PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgZVBJOiBubyBjYXRlZ29yeSAiQ29tcG9zaXRpb24iIGZvdW5kJyk7CiAgICB9CgogICAgaWYgKCFtYXRjaEZvdW5kKSB7CiAgICAgICAgY29uc29sZS5sb2coImVQSSBpcyBub3QgZm9yIGEgaGlnaC1yaXNrIHNpZGUgZWZmZWN0IG1lZGljYXRpb24iKTsKICAgICAgICByZXR1cm4gaHRtbERhdGE7CiAgICB9CgogICAgZWxzZSB7CgoKICAgICAgICBsZXQgcmVzcG9uc2UgPSBodG1sRGF0YTsKICAgICAgICBsZXQgZG9jdW1lbnQ7CgogICAgICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICBsZXQganNkb20gPSBhd2FpdCBpbXBvcnQoImpzZG9tIik7CiAgICAgICAgICAgIGxldCB7IEpTRE9NIH0gPSBqc2RvbTsKICAgICAgICAgICAgbGV0IGRvbSA9IG5ldyBKU0RPTShodG1sRGF0YSk7CiAgICAgICAgICAgIGRvY3VtZW50ID0gZG9tLndpbmRvdy5kb2N1bWVudDsKICAgICAgICAgICAgcmV0dXJuIGluc2VydFF1ZXN0aW9ubmFpcmVMaW5rKGNhdGVnb3JpZXMsIGxhbmd1YWdlRGV0ZWN0ZWQsIGRvY3VtZW50LCByZXNwb25zZSk7CiAgICAgICAgICAgIC8vbGlzdE9mQ2F0ZWdvcmllcywgZW5oYW5jZVRhZywgZG9jdW1lbnQsIHJlc3BvbnNlCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZG9jdW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQ7CiAgICAgICAgICAgIHJldHVybiBpbnNlcnRRdWVzdGlvbm5haXJlTGluayhjYXRlZ29yaWVzLCBsYW5ndWFnZURldGVjdGVkLCBkb2N1bWVudCwgcmVzcG9uc2UpOwogICAgICAgIH0KICAgIH07Cn07CgpyZXR1cm4gewogICAgZW5oYW5jZTogZW5oYW5jZSwKICAgIGdldFNwZWNpZmljYXRpb246IGdldFNwZWNpZmljYXRpb24sCn07Cg=="
}